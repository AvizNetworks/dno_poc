# vasn_tap - Example runtime + filter/tunnel config
# Use: vasn_tap -c config.example.yaml
# Validate only: vasn_tap -V -c config.example.yaml
#
# Runtime section is mandatory. filter section is mandatory.
# default_action applies when no rule matches.
# Rules are evaluated first-match; empty rules => default_action for every packet.

runtime:
  input_iface: lo
  output_iface:        # optional unless tunnel section is enabled
  mode: afpacket             # afpacket | ebpf
  workers: 4                 # 0 = auto (num CPUs)
  verbose: false
  debug: false
  stats: true
  filter_stats: true
  resource_usage: true
  truncate:
    enabled: false
    length: 64              # valid when enabled: 64..9000

filter:
  default_action: drop   # allow | drop
  rules:
     # Allow TCP to port 22 (e.g. SSH)
    - action: drop
      match:
        protocol: tcp
        port_dst: 22

   # Allow TCP to port 443 (e.g. HTTPS)
    - action: allow
      match:
        protocol: tcp
        port_dst: 8000

    - action: allow
      match:
        protocol: tcp
        port_src: 8000


    - action: drop
      match:
        protocol: tcp
        port_dst: 8080


    # Allow TCP 
    - action: drop
      match:
        protocol: tcp

    # Allow UDP
    - action: drop
      match:
        protocol: udp


    # Allow traffic from a subnet
    - action: allow
      match:
        ip_src: 192.168.200.0/24

    # Allow ICMP (ping)
    - action: allow
      match:
        protocol: icmp

# Match fields (all optional within each rule's match):
#   protocol: tcp | udp | icmp | icmpv6 | or number (e.g. 6)
#   port_src, port_dst: 1-65535
#   ip_src, ip_dst: IPv4 address or CIDR (e.g. 10.0.0.0/8)
#   eth_type: 0x0800 (IPv4) or decimal
#

# Tunnel (optional): when present, encapsulate allowed packets and send to remote VTEP
#tunnel:
#  type: vxlan
#  remote_ip: 192.168.200.1
#  vni: 1000
#  dstport: 4789
#   local_ip: optional; else from output interface (-o)

    
# For GRE: type: gre, remote_ip (required), key (optional), local_ip (optional)
#tunnel:
#  type: gre
#  remote_ip: 10.4.5.187
#  key: 1000
#  local_ip: optional; else from output interface (-o)
